<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Custom Element Registration Guard - MUST be FIRST to catch TinyMCE/Vite overlay -->
    <script>
      (function () {
        'use strict';
        if (typeof window === "undefined") return;

        // Store original customElements reference
        let originalCustomElements = window.customElements;

        // Intercept customElements before polyfills can set it
        Object.defineProperty(window, 'customElements', {
          configurable: true,
          enumerable: true,
          get() {
            return originalCustomElements;
          },
          set(value) {
            originalCustomElements = value;
            wrapCustomElementsDefine();
          }
        });

        function wrapCustomElementsDefine() {
          if (!originalCustomElements || !originalCustomElements.define) {
            return;
          }

          const originalDefine = originalCustomElements.define.bind(originalCustomElements);
          originalCustomElements.define = function(name, constructor, options) {
            if (name === 'mce-autosize-textarea') {
              // Suppress duplicate definition error
              if (originalCustomElements.get(name)) {
                return;
              }
            }
            return originalDefine(name, constructor, options);
          };
        }

        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', wrapCustomElementsDefine);
        } else {
          wrapCustomElementsDefine();
        }
      })();
    </script>

    <!-- Error Constructor Wrapping - Suppress TinyMCE errors at source -->
    <script>
      (function() {
        'use strict';
        if (typeof window === "undefined") return;

        const OriginalError = window.Error;
        window.Error = function(message) {
          if (typeof message === 'string' && message.includes('mce-autosize-textarea')) {
            // Suppress this error - return a dummy error object that won't throw
            const dummyError = new OriginalError(message);
            dummyError.name = 'SuppressedError';
            return dummyError;
          }
          return new OriginalError(message);
        };
        // Preserve Error prototype and static properties
        window.Error.prototype = OriginalError.prototype;
        Object.setPrototypeOf(window.Error, OriginalError);
        // Copy static properties
        Object.keys(OriginalError).forEach(function(key) {
          window.Error[key] = OriginalError[key];
        });
      })();
    </script>

    <!-- Theme Init - Zero-FOUC theme loading -->
    <script>
      (function() {
        'use strict';
        try {
          const ls = localStorage.getItem('theme'); // 'light' | 'dark' | 'system'
          const brand = localStorage.getItem('brand') || 'cmo'; // default: cmo
          const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
          const theme = ls === 'system' || !ls ? (prefersDark ? 'dark' : 'light') : ls;
          const isDark = theme === 'dark';

          document.documentElement.classList.toggle('dark', isDark);
          document.documentElement.setAttribute('data-brand', brand);

          // Update theme-color meta tag immediately (for Chrome/Edge/Safari)
          // Firefox and Opera ignore this tag - we use CSS color-scheme for them instead
          const themeColorMeta = document.querySelector('meta[name="theme-color"]');
          if (themeColorMeta) {
            themeColorMeta.setAttribute('content', isDark ? '#0b0b0c' : '#ffffff');
          }

          // Set CSS color-scheme for Firefox/Opera support
          document.documentElement.style.colorScheme = isDark ? 'dark' : 'light';
        } catch(e) {
          // Silently fail if localStorage is unavailable
        }
      })();
    </script>

    <!-- Primary Meta Tags -->
    <title>Jacob Darling | Fractional CMO & Marketing Technologist</title>
    <meta name="title" content="Jacob Darling | Fractional CMO & Marketing Technologist" />
    <meta name="description" content="16+ years of experience blending creative strategy, marketing automation, and systems thinking to drive scalable growth. Explore full-funnel campaigns, CRM architecture, and performance marketing across SaaS, healthcare, and more." />
    <meta name="keywords" content="fractional CMO, marketing technologist, marketing strategist, marketing automation, CRM campaigns, systems architecture, growth marketing, performance marketing, Indianapolis marketing, marketing consultant, SaaS marketing, healthcare marketing" />
    <meta name="author" content="Jacob Darling" />
    <meta name="robots" content="index, follow" />
    <meta name="language" content="English" />
    <meta name="revisit-after" content="7 days" />

    <!-- Theme Color -->
    <meta name="theme-color" content="#ffffff" />
    <meta name="msapplication-TileColor" content="#0b0b0c" />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://mem-rebuild-pl.pages.dev/" />
    <meta property="og:title" content="Jacob Darling | Fractional CMO & Marketing Technologist" />
    <meta property="og:description" content="16+ years of experience blending creative strategy, marketing automation, and systems thinking to drive scalable growth. Explore full-funnel campaigns, CRM architecture, and performance marketing across SaaS, healthcare, and more." />
    <meta property="og:image" content="https://mem-rebuild-pl.pages.dev/og-image.jpg" />
    <meta property="og:site_name" content="Jacob Darling Portfolio" />
    <meta property="og:locale" content="en_US" />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content="https://mem-rebuild-pl.pages.dev/" />
    <meta name="twitter:title" content="Jacob Darling | Fractional CMO & Marketing Technologist" />
    <meta name="twitter:description" content="16+ years of experience blending creative strategy, marketing automation, and systems thinking to drive scalable growth." />
    <meta name="twitter:image" content="https://mem-rebuild-pl.pages.dev/og-image.jpg" />

    <!-- Canonical URL -->
    <link rel="canonical" href="https://mem-rebuild-pl.pages.dev/" />

    <!-- Resource Hints - Preconnect for faster font loading -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">
    <link rel="dns-prefetch" href="https://fonts.gstatic.com">

    <!-- Preconnect to external APIs -->
    <link rel="preconnect" href="https://www.google-analytics.com">
    <link rel="dns-prefetch" href="https://www.googletagmanager.com">

    <!-- Fonts with display=swap for better performance -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800;900&family=Inter:wght@300;400;500;600;700;800;900&family=Space+Grotesk:wght@300;400;500;600;700&family=Newsreader:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&display=swap" rel="stylesheet">

    <!-- Preload critical assets -->
    <!-- Note: Only preload resources that are used immediately on page load -->
    <!-- Video preload removed - let browser handle video loading -->
    <!-- Image preloads removed - images are loaded when components render -->

    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />

    <!-- Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "Jacob Darling",
      "jobTitle": "Fractional CMO & Marketing Technologist",
      "url": "https://mem-rebuild-pl.pages.dev/",
      "email": "mailto:jacob@jacobdarling.com",
      "image": "https://mem-rebuild-pl.pages.dev/og-image.jpg",
      "sameAs": [
        "https://linkedin.com/in/jacobdarling",
        "https://github.com/JdarlingGT"
      ],
      "address": {
        "@type": "PostalAddress",
        "addressLocality": "Indianapolis",
        "addressRegion": "IN",
        "addressCountry": "US"
      },
      "description": "16+ years of experience blending creative strategy, marketing automation, and systems thinking to drive scalable growth across SaaS, healthcare, and more.",
      "knowsAbout": [
        "Fractional CMO",
        "Marketing Automation",
        "CRM Systems",
        "Performance Marketing",
        "Marketing Technology",
        "Growth Marketing",
        "Analytics",
        "Conversion Optimization",
        "SaaS Marketing",
        "Healthcare Marketing",
        "Lead Generation",
        "Marketing Strategy"
      ],
      "alumniOf": {
        "@type": "Organization",
        "name": "Marketing & Technology Professional"
      }
    }
    </script>

    <!-- Vite will inject modulepreload links for built assets during build -->
    <!-- Critical CSS is inlined in the build output -->
  </head>
  <body>
    <div id="root">
      <div class="initial-loader">
        <div class="initial-loader-content">
          <div class="spinner"></div>
          <p class="initial-loader-text">Loading portfolio...</p>
        </div>
      </div>
    </div>
    <noscript>
      <div class="noscript-message">
        <div>
          <h1>JavaScript Required</h1>
          <p>This portfolio requires JavaScript to function. Please enable JavaScript in your browser settings.</p>
        </div>
      </div>
    </noscript>
    <!-- Vite will automatically inject the correct entry script during build -->
    <script type="module" src="/src/main.tsx"></script>

    <!-- Enhanced error detection for production -->
    <script>
      // Enhanced error detection to help diagnose loading issues
      window.addEventListener('error', function(e) {
        if (!e) return;

        // Aggressively suppress TinyMCE custom element errors (from Vite overlay)
        const message = e.message || '';
        const filename = e.filename || '';

        if (message.includes('mce-autosize-textarea') || filename.includes('webcomponents-ce.js')) {
          // Silently ignore TinyMCE/Vite overlay errors
          e.preventDefault();
          e.stopPropagation();
          return false;
        }

        console.error('Global error caught:', {
          message: e.message,
          filename: e.filename,
          lineno: e.lineno,
          colno: e.colno,
          error: e.error
        });

        // If it's a module loading error, show helpful message
        if (e.message && (e.message.includes('Failed to fetch') ||
                          e.message.includes('module script') ||
                          e.message.includes('MIME type') ||
                          e.message.includes('net::ERR'))) {
          const root = document.getElementById('root');
          if (root && root.querySelector('.initial-loader')) {
            root.innerHTML = `
              <style>
                .error-container {
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  min-height: 100vh;
                  background: #0A0A0A;
                  color: #FFFFFF;
                  padding: 2rem;
                  text-align: center;
                }
                .error-title {
                  font-size: 1.5rem;
                  margin-bottom: 1rem;
                  color: #EF4444;
                }
                .error-message {
                  opacity: 0.8;
                  margin-bottom: 1rem;
                  font-family: monospace;
                  font-size: 0.9rem;
                }
                .error-button {
                  margin-top: 1rem;
                  padding: 0.75rem 2rem;
                  background: #3B82F6;
                  color: white;
                  border: none;
                  border-radius: 8px;
                  cursor: pointer;
                }
              </style>
              <div class="error-container">
                <div>
                  <h2 class="error-title">Script Loading Error</h2>
                  <p class="error-message">${e.message}</p>
                  <p style="opacity: 0.7; margin-top: 1rem;">
                    The application scripts failed to load. This might be a network issue or a build configuration problem.
                  </p>
                  <button class="error-button" onclick="window.location.reload()">
                    Reload Page
                  </button>
                </div>
              </div>
            `;
          }
        }
      }, true);

      // Also catch unhandled promise rejections
      window.addEventListener('unhandledrejection', function(e) {
        // Aggressively suppress TinyMCE custom element errors
        const reason = String(e.reason || '');
        if (
          reason.includes('mce-autosize-textarea') ||
          reason.includes('mce-') ||
          reason.includes('has already been defined') ||
          reason.includes('has already been used') ||
          reason.includes('webcomponents-ce') ||
          reason.includes('overlay_bundle')
        ) {
          e.preventDefault();
          e.stopPropagation();
          return;
        }
        console.error('Unhandled promise rejection:', e.reason);
      });

      // Timeout to detect if nothing loads after 15 seconds
      setTimeout(function() {
        const root = document.getElementById('root');
        if (root && root.querySelector('.initial-loader')) {
          console.error('Application failed to load after 15 seconds');
          root.innerHTML = `
            <style>
              .timeout-container {
                display: flex;
                align-items: center;
                justify-content: center;
                min-height: 100vh;
                background: #0A0A0A;
                color: #FFFFFF;
                padding: 2rem;
                text-align: center;
              }
              .timeout-title {
                font-size: 1.5rem;
                margin-bottom: 1rem;
                color: #F59E0B;
              }
              .timeout-button {
                margin-top: 1rem;
                padding: 0.75rem 2rem;
                background: #3B82F6;
                color: white;
                border: none;
                border-radius: 8px;
                cursor: pointer;
              }
            </style>
            <div class="timeout-container">
              <div>
                <h2 class="timeout-title">Loading Timeout</h2>
                <p style="opacity: 0.8; margin-bottom: 1rem;">
                  The application is taking longer than expected to load.
                </p>
                <p style="opacity: 0.6; font-size: 0.9rem; margin-bottom: 1rem;">
                  Please check the browser console (F12) for errors.
                </p>
                <button class="timeout-button" onclick="window.location.reload()">
                  Reload Page
                </button>
              </div>
            </div>
          `;
        }
      }, 15000);
    </script>
  </body>
</html>
